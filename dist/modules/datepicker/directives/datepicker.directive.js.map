{"version":3,"file":"datepicker.directive.js","sourceRoot":"","sources":["../../../../src/modules/datepicker/directives/datepicker.directive.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    Directive, ElementRef, Renderer2, EventEmitter, Output, Input,\n    HostListener, OnChanges, SimpleChanges\n} from \"@angular/core\";\nimport { AbstractControl, ValidationErrors } from \"@angular/forms\";\nimport {\n    ICustomValueAccessorHost, customValueAccessorFactory, CustomValueAccessor,\n    ICustomValidatorHost, customValidatorFactory, CustomValidator, PositioningPlacement, SuiComponentFactory, KeyCode\n} from \"../../../misc/util/index\";\nimport { IDatepickerLocaleValues, RecursivePartial, SuiLocalizationService } from \"../../../behaviors/localization/index\";\nimport { SuiPopupComponentController, PopupAfterOpen, PopupConfig, PopupTrigger } from \"../../popup/index\";\nimport { SuiDatepicker, DatepickerMode } from \"../components/datepicker\";\nimport { CalendarConfig, YearConfig, MonthConfig, DatetimeConfig, TimeConfig, DateConfig } from \"../classes/calendar-config\";\n\n@Directive({\n    selector: \"[suiDatepicker]\",\n    providers: [customValidatorFactory(SuiDatepickerDirective)]\n})\nexport class SuiDatepickerDirective\n       extends SuiPopupComponentController<SuiDatepicker>\n       implements ICustomValueAccessorHost<Date>, ICustomValidatorHost, OnChanges, PopupAfterOpen {\n\n    private _selectedDate?:Date;\n\n    public get selectedDate():Date | undefined {\n        return this._selectedDate;\n    }\n\n    public set selectedDate(date:Date | undefined) {\n        this._selectedDate = date;\n        this.onSelectedDateChange.emit(date);\n    }\n\n    private _mode:DatepickerMode;\n    public config:CalendarConfig;\n\n    @Input(\"pickerMode\")\n    public get mode():DatepickerMode {\n        return this._mode;\n    }\n\n    public set mode(mode:DatepickerMode) {\n        this._mode = mode || DatepickerMode.Datetime;\n        switch (this._mode) {\n            case DatepickerMode.Year:\n                this.config = new YearConfig();\n                break;\n            case DatepickerMode.Month:\n                this.config = new MonthConfig();\n                break;\n            case DatepickerMode.Date:\n            default:\n                this.config = new DateConfig();\n                break;\n            case DatepickerMode.Datetime:\n                this.config = new DatetimeConfig();\n                break;\n            case DatepickerMode.Time:\n                this.config = new TimeConfig();\n                break;\n        }\n        this.writeValue(this.selectedDate);\n    }\n\n    @Input(\"pickerInitialDate\")\n    public initialDate?:Date;\n\n    @Input(\"pickerMaxDate\")\n    public maxDate?:Date;\n\n    @Input(\"pickerMinDate\")\n    public minDate?:Date;\n\n    @Input(\"pickerFirstDayOfWeek\")\n    public firstDayOfWeek?:number;\n\n    private _localeValues:IDatepickerLocaleValues;\n\n    @Input(\"pickerLocaleOverrides\")\n    public localeOverrides:RecursivePartial<IDatepickerLocaleValues>;\n\n    public get localeValues():IDatepickerLocaleValues {\n        return this.localizationService.override<\"datepicker\">(this._localeValues, this.localeOverrides);\n    }\n\n    @Input(\"pickerPlacement\")\n    public set placement(placement:PositioningPlacement) {\n        this.popup.config.placement = placement;\n    }\n\n    @Input(\"pickerTransition\")\n    public set transition(transition:string) {\n        this.popup.config.transition = transition;\n    }\n\n    @Input(\"pickerTransitionDuration\")\n    public set transitionDuration(duration:number) {\n        this.popup.config.transitionDuration = duration;\n    }\n\n    @Output(\"pickerSelectedDateChange\")\n    public onSelectedDateChange:EventEmitter<Date>;\n\n    @Output(\"pickerValidatorChange\")\n    public onValidatorChange:EventEmitter<void>;\n\n    constructor(public renderer:Renderer2,\n                element:ElementRef,\n                componentFactory:SuiComponentFactory,\n                public localizationService:SuiLocalizationService) {\n\n        super(renderer, element, componentFactory, SuiDatepicker, new PopupConfig({\n            trigger: PopupTrigger.Focus,\n            placement: PositioningPlacement.BottomLeft,\n            transition: \"scale\",\n            transitionDuration: 200\n        }));\n\n        // This ensures the popup is drawn correctly (i.e. no border).\n        this.renderer.addClass(this.popup.elementRef.nativeElement, \"ui\");\n        this.renderer.addClass(this.popup.elementRef.nativeElement, \"calendar\");\n\n        this.onLocaleUpdate();\n        this.localizationService.onLanguageUpdate.subscribe(() => this.onLocaleUpdate());\n\n        this.onSelectedDateChange = new EventEmitter<Date>();\n        this.onValidatorChange = new EventEmitter<void>();\n\n        this.mode = DatepickerMode.Datetime;\n    }\n\n    public popupOnOpen():void {\n        if (this.componentInstance) {\n            this.componentInstance.service.config = this.config;\n            this.componentInstance.service.localeValues = this.localeValues;\n            this.componentInstance.service.currentDate = this.initialDate || new Date();\n            this.componentInstance.service.selectedDate = this.selectedDate;\n            this.componentInstance.service.maxDate = this.maxDate;\n            this.componentInstance.service.minDate = this.minDate;\n\n            if (this.firstDayOfWeek != undefined) {\n                this.componentInstance.service.firstDayOfWeek = this.firstDayOfWeek;\n            }\n\n            this.componentInstance.service.reset();\n\n            this.componentInstance.service.onDateChange.subscribe((d:Date) => {\n                this.selectedDate = d;\n                this.close();\n            });\n        }\n    }\n\n    public ngOnChanges({ maxDate, minDate, mode }:SimpleChanges):void {\n        if (maxDate || minDate || mode) {\n            this.onValidatorChange.emit();\n        }\n    }\n\n    private onLocaleUpdate():void {\n        this._localeValues = this.localizationService.get().datepicker;\n    }\n\n    public validate(c:AbstractControl):ValidationErrors | null {\n        const value = c.value;\n\n        if (value != undefined) {\n            // We post process the min & max date because sometimes this puts the date outside of the allowed range.\n            if (this.minDate && value < this.minDate) {\n                return { suiMinDate: { required: this.minDate, actual: value } };\n            }\n\n            if (this.maxDate && value > this.maxDate) {\n                return { suiMaxDate: { required: this.maxDate, actual: value } };\n            }\n        }\n\n        // Angular expects null\n        // tslint:disable-next-line:no-null-keyword\n        return null;\n    }\n\n    public writeValue(value:Date | undefined):void {\n        this.selectedDate = value;\n\n        if (this.componentInstance) {\n            this.componentInstance.service.selectedDate = value;\n        }\n    }\n\n    @HostListener(\"keydown\", [\"$event\"])\n    public onKeyDown(e:KeyboardEvent):void {\n        if (e.keyCode === KeyCode.Escape) {\n            this.close();\n        }\n    }\n}\n\n@Directive({\n    selector: \"[suiDatepicker]\",\n    host: { \"(pickerSelectedDateChange)\": \"onChange($event)\" },\n    providers: [customValueAccessorFactory(SuiDatepickerDirectiveValueAccessor)]\n})\nexport class SuiDatepickerDirectiveValueAccessor extends CustomValueAccessor<Date, SuiDatepickerDirective> {\n    constructor(public host:SuiDatepickerDirective) { super(host); }\n}\n\n@Directive({\n    selector: \"[suiDatepicker]\",\n    host: { \"(pickerValidatorChange)\": \"onValidatorChange()\" },\n    providers: [customValidatorFactory(SuiDatepickerDirectiveValidator)]\n})\nexport class SuiDatepickerDirectiveValidator extends CustomValidator<SuiDatepickerDirective> {\n    constructor(public host:SuiDatepickerDirective) { super(host); }\n}\n"]}