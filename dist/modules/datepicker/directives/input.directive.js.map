{"version":3,"file":"input.directive.js","sourceRoot":"","sources":["../../../../src/modules/datepicker/directives/input.directive.ts"],"names":[],"mappings":"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","sourcesContent":["\nimport { Directive, Host, Input, ElementRef, HostBinding, HostListener } from \"@angular/core\";\nimport { DateUtil, DatePrecision } from \"../../../misc/util/index\";\nimport { SuiLocalizationService } from \"../../../behaviors/localization/index\";\nimport { PopupTrigger } from \"../../popup/index\";\nimport { SuiDatepickerDirective, SuiDatepickerDirectiveValueAccessor } from \"./datepicker.directive\";\nimport { InternalDateParser, DateParser } from \"../classes/date-parser\";\nimport * as bowser from \"bowser\";\n\nimport \"../helpers/is-webview\";\nimport * as isUAWebView from \"is-ua-webview\";\nconst isWebView = isUAWebView[\"default\"] || isUAWebView;\n\n@Directive({\n    selector: \"input[suiDatepicker]\"\n})\nexport class SuiDatepickerInputDirective {\n    private _useNativeOnMobile:boolean;\n\n    @Input(\"pickerUseNativeOnMobile\")\n    public get useNativeOnMobile():boolean {\n        return this._useNativeOnMobile;\n    }\n\n    public set useNativeOnMobile(fallback:boolean) {\n        this._useNativeOnMobile = fallback;\n        const isOnMobile = bowser.mobile || bowser.tablet || isWebView(navigator.userAgent);\n        this.fallbackActive = this.useNativeOnMobile && isOnMobile;\n    }\n\n    private _fallbackActive:boolean;\n\n    public get fallbackActive():boolean {\n        return this._fallbackActive;\n    }\n\n    public set fallbackActive(active:boolean) {\n        this._fallbackActive = active;\n        // If the fallback is active, then the trigger must be manual so the datepicker never opens.\n        this.datepicker.popup.config.trigger = this.fallbackActive ? PopupTrigger.Manual : PopupTrigger.Focus;\n        // Update the input value (this will insert the `T` as required).\n        this.updateValue(this.selectedDateString);\n    }\n\n    public get parser():DateParser {\n        if (this.fallbackActive) {\n            return new InternalDateParser(this.datepicker.mode, this.datepicker.localeValues);\n        }\n        return new DateParser(this.datepicker.localeValues.formats[this.datepicker.mode], this.datepicker.localeValues);\n    }\n\n    private _currentInputValue:string | undefined;\n    private _lastUpdateTyped:boolean;\n\n    public get selectedDateString():string | undefined {\n        if (this.datepicker.selectedDate) {\n            return this.parser.format(this.datepicker.selectedDate);\n        }\n    }\n\n    @HostBinding(\"attr.type\")\n    public get type():string {\n        if (this.fallbackActive) {\n            return this.datepicker.config.fallback;\n        }\n        return \"text\";\n    }\n\n    @HostBinding(\"attr.max\")\n    public get max():string | undefined {\n        if (this.fallbackActive && this.datepicker.maxDate) {\n            // Since HTML doesn't use a date object max is somewhat tricky.\n            // Our Datepicker will always choose the 1st date on the provided precision,\n            // meaning anything below the maxDate will work, hence endOf.\n            const max = DateUtil.endOf(this.datepicker.config.precision, DateUtil.clone(this.datepicker.maxDate));\n            return this.parser.format(max);\n        }\n    }\n\n    @HostBinding(\"attr.min\")\n    public get min():string | undefined {\n        if (this.fallbackActive && this.datepicker.minDate) {\n            // Since HTML doesn't use a date object min is somewhat tricky.\n            // We use 1 minute before the next date at the configured precision since\n            // our Datepicker picks the first available date at that precision.\n            const min = DateUtil.clone(this.datepicker.minDate);\n            return this.parser.format(min);\n        }\n    }\n\n    constructor(@Host() public datepicker:SuiDatepickerDirective,\n                @Host() public valueAccessor:SuiDatepickerDirectiveValueAccessor,\n                public element:ElementRef,\n                localizationService:SuiLocalizationService) {\n        this.useNativeOnMobile = true;\n        this.fallbackActive = false;\n\n        // Whenever the datepicker value updates, update the input text alongside it.\n        this.datepicker.onSelectedDateChange.subscribe(() =>\n            this.updateValue(this.selectedDateString));\n\n        localizationService.onLanguageUpdate.subscribe(() =>\n            this.updateValue(this.selectedDateString));\n    }\n\n    private updateValue(value:string | undefined):void {\n        // Only update the current value if it is different to what it's being updated to.\n        // This is so that the editing position isn't changed when manually typing the date.\n        if (!this._lastUpdateTyped) {\n            this.datepicker.renderer.setProperty(this.element.nativeElement, \"value\", value || \"\");\n        }\n\n        this._lastUpdateTyped = false;\n    }\n\n    @HostListener(\"input\", [\"$event.target.value\"])\n    public typeValue(value:string | undefined):void {\n        this._lastUpdateTyped = true;\n        this._currentInputValue = value;\n\n        if (!value) {\n            // Delete the selected date if no date was entered manually.\n            return this.datepicker.writeValue(undefined);\n        }\n\n        const parsed = this.parser.parse(value, this.datepicker.selectedDate);\n        if (!isNaN(parsed.getTime()) && value === this.parser.format(parsed)) {\n            return this.datepicker.writeValue(parsed);\n        }\n        return this.datepicker.writeValue(undefined);\n    }\n\n    @HostListener(\"focusout\")\n    public onFocusOut():void {\n        this.valueAccessor.onTouched();\n    }\n}\n"]}